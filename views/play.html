<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script> -->
  <!-- LINKS  -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Rammetto+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="src/css/jquerymodal.css">
  <link rel="stylesheet" href="src/css/buttons.css">
  <link rel="stylesheet" href="src/css/play.css">
  <link rel="stylesheet" href="src/css/toltip.css">
  <link rel="stylesheet" href="src/css/base.css">
 


  <title>Play</title>
</head>

<body>
 <!--   SCRIPTS -->
 <script src="src/js/jquery-3.6.0.min.js"></script>
 <script src="src/js/jquerymodal.js" defer></script>
 <script src="src/js/index.js" defer></script>
 <script src="src/js/Three.js"></script>
 <script src="src/js/Detector.js"></script>
 <script src="src/js/Stats.js"></script>
 <script src="src/js/OrbitControls.js"></script>
 <script src="src/js/KeyboardState.js"></script>
 <script src="src/js/THREEx.FullScreen.js"></script>
 <script src="src/js/THREEx.WindowResize.js"></script>
 <script src="src/js/ParticleEngine.js"></script>
 <script src="src/js/ParticleEngineExamples.js"></script>
 <script src="src/js/firebase.js" defer></script>







  <div>
    <audio id="soundclick" src="assets/button-34.wav"></audio>
    <div class="container" style="display: none;">
      <div class="pause">
        <p>PAUSA</p>
        <button class="btn static" onclick="SoundClick()" id="btn_reanudar">
          <span class="btn__inner static">
            <span class="btn__slide" static></span>
            <span class="btn__content static">Reanudar</span>
          </span>
        </button>
        <a class="btn static" onclick="SoundClick()" href="#m_confi" rel="modal:open">
          <span class="btn__inner static">
            <span class="btn__slide" static></span>
            <span class="btn__content static">Configuraciones</span>
          </span>
        </a>
        <a class="btn static" onclick="SoundClick()" id="btn_salir" href="index.html">
          <span class="btn__inner static">
            <span class="btn__slide" static></span>
            <span class="btn__content static">Abandonar</span>
          </span>
        </a>
      </div>
    </div>
    <div id="m_confi" class="modal" style="display: none;">
      <p>Configuración</p>

      <div>
        <p>Volumen</p>
      </div>
      <div class="range-slider ">
        <input class="range-slider__range" type="range" value="100" min="0" max="500">
        <span class="range-slider__value">0</span>
      </div>
      <div style="text-align-last: center; width: 100%; ">
        <button class="btn static" onclick="SoundClick()" id="btn_save">
          <span class="btn__inner static">
            <span class="btn__slide" static></span>
            <span class="btn__content static">Guardar</span>
          </span>
        </button>
      </div>
    </div>
  </div>
  <div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
  <script type="module">
    import { GLTFLoader } from "../views/src/js/GLTFLoader.js";
    // MAIN
    var battleShip;
    var pared;
    var rueda;
    var rueda2;
    var estatua;
    var rock;
    var powerUpHeal;
    var powerUpShield;
    var powerUpRocket;
    var firstBB;
    var secondBB;
    var collision;
    var texturat;
    var rock2;
    //IMAGES SKYDOME







    // standard global variables
    var container, scene, camera, renderer, controls, stats, skyboxGeo, skybox;
    var keyboard = new THREEx.KeyboardState();
    var clock = new THREE.Clock();

    // custom global variables
    var mesh;

    init();
    animate();

    // FUNCTIONS 		
    function init() {
      // SCENE
      scene = new THREE.Scene();
      // CAMERA
      var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
      var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
      camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
      scene.add(camera);
      camera.position.set(0, 150, 400);
      camera.lookAt(scene.position);
      // RENDERER
      if (Detector.webgl)
        renderer = new THREE.WebGLRenderer({ antialias: true });
      else
        renderer = new THREE.RendereCanvasr();
      renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
      container = document.getElementById('ThreeJS');
      container.appendChild(renderer.domElement);



      // EVENTS
      THREEx.WindowResize(renderer, camera);
      THREEx.FullScreen.bindKey({ charCode: 'm'.charCodeAt(0) });


      // CONTROLS
      controls = new THREE.OrbitControls(camera, renderer.domElement);


      // STATS
      stats = new Stats();
      stats.domElement.style.position = 'absolute';
      stats.domElement.style.bottom = '0px';
      stats.domElement.style.zIndex = 100;
      container.appendChild(stats.domElement);



      //Iluminación 
    var ambientLight = new THREE.AmbientLight(
        new THREE.Color(1, 1, 1),
        0.5
    );

    var directionalLight = new THREE.DirectionalLight(
        new THREE.Color(133, 23, 0),
        0.1
    );

    directionalLight.position.set(0, 2, 1);

    scene.add( ambientLight );
    scene.add( directionalLight );

      // FLOOR
      texturat = new THREE.TextureLoader().load("../views/src/js/imagenes/lava.jpg");
      texturat.wrapS = texturat.wrapT = THREE.RepeatWrapping;
      texturat.repeat.set(0.6, 0.6);
      var floorMaterial = new THREE.MeshBasicMaterial({ map: texturat, side: THREE.DoubleSide });
      var floorGeometry = new THREE.PlaneGeometry(5000, 5000, 10, 10);
      var floor = new THREE.Mesh(floorGeometry, floorMaterial);
      floor.position.y = -0.5;
      floor.rotation.x = Math.PI / 2;
      scene.add(floor);
      var cubemat = [
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_ft.png"), side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_bk.png"), side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_up.png"), side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_dn.png"), side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_rt.png"), side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: new THREE.TextureLoader().load("../views/src/js/imagenes/hot_lf.png"), side: THREE.BackSide })
      ];
      var cubematerial = new THREE.MeshFaceMaterial(cubemat);
      skyboxGeo = new THREE.BoxGeometry(10000, 10000, 10000);
      var cube = new THREE.Mesh(skyboxGeo, cubematerial)
      cube.position.x = 0;
      scene.add(cube);


      ////////////
      // CUSTOM //
      ////////////
      var loader = new GLTFLoader().setPath('../views/src/assets/gltf/Ships/');
      loader.load('barco1.gltf', (gltf) => {

        battleShip = gltf.scene;

        battleShip.position.x = 0;
        battleShip.position.y = 3;
        battleShip.name = "battleShip";

        scene.add(battleShip);

      });


      loader.load('volcan.gltf', (gltf) => {

        pared = gltf.scene;

        pared.position.x = 10;
        pared.position.y = 5;

        pared.name = "pared";

        scene.add(pared);

      });


      loader.load('rueda.gltf', (gltf) => {

        rueda = gltf.scene;

        rueda.position.x = 20;
        rueda.position.z = 500;
        rueda.position.y = 5;

        rueda.name = "rueda";
        //scene.add(rueda);


        rueda2 = rueda.clone();

        rueda2.position.x = 100;
        rueda2.name = "rueda2";
        //scene.add(rueda2);

      });

      loader.load('estatua.gltf', (gltf) => {

        estatua = gltf.scene;

        estatua.position.x = -1500;
        estatua.position.z = 1200;
        estatua.position.y = 30;

        estatua.name = "estatua";
        scene.add(estatua);

      });

      loader.load('rock.gltf', (gltf) => {

        rock = gltf.scene;

        rock.position.x = 1700;
        rock.position.z = 0;
        rock.position.y = 30;

        rock.name = "rock";
        scene.add(rock);

        rock2 = rock.clone();

        rock2.position.x = -1700;
        rock2.position.z = 0;
        rock2.name = "rock2";
        scene.add(rock2);




      });

      loader.load('powerUpHeal.gltf', (gltf) => {

        powerUpHeal = gltf.scene;

        powerUpHeal.position.x = 1200;
        powerUpHeal.position.z = 1000;
        powerUpHeal.position.y = 100;

        powerUpHeal.name = "powerUpHeal";
        scene.add(powerUpHeal);

      });

      loader.load('powerUpShield.gltf', (gltf) => {

        powerUpShield = gltf.scene;

        powerUpShield.position.x = -1200;
        powerUpShield.position.z = -1000;
        powerUpShield.position.y = 100;

        powerUpShield.name = "powerUpShield";
        scene.add(powerUpShield);

      });

      loader.load('powerUpRocket.gltf', (gltf) => {

        powerUpRocket = gltf.scene;

        powerUpRocket.position.x = 600;
        powerUpRocket.position.z = 100;
        powerUpRocket.position.y = 100;

        powerUpRocket.name = "powerUpRocket";
        scene.add(powerUpRocket);

      });


    }



    function animate() {
      requestAnimationFrame(animate);
      render();
      update();
    }

    function update() {

      function colisionBloques() {

        if (Math.sqrt(Math.pow((battleShip.position.x - pared.position.x), 2) + Math.pow((battleShip.position.z - pared.position.z), 2)) < 300) {
          console.log("joto");
        }

      }

      var delta = clock.getDelta(); // seconds.
      var moveDistance = 600 * delta; // 200 pixels per second
      var rotateAngle = Math.PI / 2 * delta;
      var rotation_matrix = new THREE.Matrix4().identity();
      var powerUpHeal = scene.getObjectByName("powerUpHeal");
      var powerUpShield = scene.getObjectByName("powerUpShield");
      var powerUpRocket = scene.getObjectByName("powerUpRocket");

      // global coordinates
      if (keyboard.pressed("left")) {
        battleShip.position.x -= moveDistance;
        battleShip.rotation.y = 0;
      }

      else if (keyboard.pressed("right")) {

        battleShip.position.x += moveDistance;

        battleShip.rotation.y = 3.14159;
      }
      else if (keyboard.pressed("up")) {
        battleShip.position.z -= moveDistance;
        battleShip.rotation.y = 4.71239;
      }

      else if (keyboard.pressed("down")) {
        battleShip.position.z += moveDistance;
        battleShip.rotation.y = 1.5708;
      }

      powerUpHeal.rotation.y += THREE.Math.degToRad(45) * delta;
      powerUpShield.rotation.y += THREE.Math.degToRad(45) * delta;
      powerUpRocket.rotation.y += THREE.Math.degToRad(45) * delta;

      colisionBloques();

      controls.update();
      stats.update();
    }

    function render() {
      texturat.offset.x += .0009;
      renderer.render(scene, camera);
    }

  </script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-database.js"></script>
  <script id="Firebase">
    var firebaseConfig = {
      apiKey: "AIzaSyD-WLwlfxASSyndVSZ8R31aCeHfYVoBxws",
      authDomain: "graficasweb-745d9.firebaseapp.com",
      databaseURL: "https://graficasweb-745d9-default-rtdb.firebaseio.com/",
      projectId: "graficasweb-745d9",
      storageBucket: "graficasweb-745d9.appspot.com",
      messagingSenderId: "762725047745",
      appId: "1:762725047745:web:440d63ec2d1f90ab34e340",
      measurementId: "G-BNWMRV61SW"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    //firebase.analytics();
  </script>
</body>

</html>